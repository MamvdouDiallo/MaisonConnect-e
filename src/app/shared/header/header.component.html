<!-- <header class="sticky top-0 z-50 backdrop-blur bg-white/70 dark:bg-black/40 border-b border-black/5">
  <nav class="container-apple h-12 flex items-center justify-between">
    <a routerLink="/" class="font-semibold text-base">{{ 'brand' | translate }}</a>

    <ul class="hidden md:flex gap-6 text-sm text-gray-600 dark:text-gray-300">
      <li *ngFor="let it of items">
        <a [routerLink]="it.link" class="hover:opacity-80 transition">
          {{ ('nav.' + it.key) | translate }}
        </a>
      </li>
    </ul>

    <div class="hidden md:flex items-center gap-3">
      <select class="border rounded px-2 py-1 bg-white dark:bg-zinc-800"
              (change)="setLang(($event.target as HTMLSelectElement).value)">
        <option *ngFor="let l of langs" [value]="l" [selected]="t.currentLang===l">{{ l.toUpperCase() }}</option>
      </select>
      <button class="text-sm border rounded px-3 py-1 bg-white dark:bg-zinc-800"
              (click)="toggleTheme()" aria-label="Toggle theme">
        ğŸŒ™/â˜€ï¸
      </button>
    </div>

    <button class="md:hidden" (click)="open.set(!open())" aria-label="Menu">â˜°</button>
  </nav>

  <div *ngIf="open()" class="md:hidden border-t border-black/5">
    <ul class="container-apple py-3 space-y-2 text-base">
      <li *ngFor="let it of items">
        <a [routerLink]="it.link" class="block py-2" (click)="open.set(false)">
          {{ ('nav.' + it.key) | translate }}
        </a>
      </li>
      <li class="pt-2 flex gap-3 items-center">
        <label class="text-sm">Langue</label>
        <select class="border rounded px-2 py-1"
                (change)="setLang(($event.target as HTMLSelectElement).value)">
          <option *ngFor="let l of langs" [value]="l" [selected]="t.currentLang===l">{{ l.toUpperCase() }}</option>
        </select>
        <button class="text-sm border rounded px-3 py-1" (click)="toggleTheme()">ğŸŒ™/â˜€ï¸</button>
      </li>
    </ul>
  </div>
</header> -->

<header class="sticky top-0 z-50 backdrop-blur-xl bg-white/60 dark:bg-black/40 border-b border-black/10">
  <nav class="container-apple h-12 flex items-center justify-between px-4">

    <!-- Logo Apple -->
    <a routerLink="/" class="text-xl font-semibold tracking-tight hover:opacity-70 transition">
      ï£¿
    </a>

    <!-- Desktop Menu -->
    <ul class="hidden md:flex items-center gap-8 text-sm text-gray-800 dark:text-gray-200">

      <li *ngFor="let group of menu; index as i" class="relative dropdown-container">

        <!-- Label -->
        <button 
          (click)="toggleMenu(i)"
          class="cursor-pointer hover:text-black dark:hover:text-white transition focus:outline-none flex items-center gap-1"
        >
          {{ group.label }}
          <span class="text-xs opacity-60">â–¾</span>
        </button>

        <!-- Dropdown -->
        <ul
          *ngIf="activeMenu() === i"
          class="absolute left-1/2 -translate-x-1/2 top-7
                 bg-white/85 dark:bg-black/70 backdrop-blur-xl
                 shadow-xl border border-black/10 rounded-xl
                 py-4 px-5 min-w-[230px] animate-fadeIn"
        >
          <li *ngFor="let item of group.children" class="py-1.5">
            <a
              [routerLink]="item.link"
              (click)="closeMenu()"
              class="block text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white transition"
            >
              {{ ('nav.' + item.key) | translate }}
            </a>
          </li>
        </ul>

      </li>

    </ul>

    <!-- Actions desktop -->
    <div class="hidden md:flex items-center gap-4">

      <!-- Lang Switch -->
      <div class="relative lang-switcher">
        <button
          (click)="toggleLangMenu()"
          class="flex items-center gap-1 px-2 py-1 rounded-full
                 hover:bg-gray-200 dark:hover:bg-zinc-700
                 transition"
        >
          <span class="text-lg">{{ flags[currentLang()] }}</span>
          <span class="text-sm">{{ currentLang().toUpperCase() }}</span>
          <span class="text-xs opacity-60">â–¾</span>
        </button>

        <div
          *ngIf="langMenuOpen()"
          class="absolute right-0 mt-2 w-32
                 bg-white/80 dark:bg-black/70 backdrop-blur-xl
                 shadow-xl border border-black/10 rounded-xl
                 py-2 animate-fadeIn"
        >
          <button
            *ngFor="let l of langs"
            (click)="setLang(l)"
            class="w-full text-left px-3 py-2 flex items-center gap-2
                   hover:bg-gray-200/70 dark:hover:bg-zinc-700 transition"
          >
            <span class="text-xl">{{ flags[l] }}</span>
            <span>{{ l.toUpperCase() }}</span>
          </button>
        </div>
      </div>

      <!-- Theme -->
      <button
        class="text-sm px-2 py-1 rounded-full bg-gray-100 dark:bg-zinc-800 hover:bg-gray-200 dark:hover:bg-zinc-700 transition"
        (click)="toggleTheme()"
      >
        ğŸŒ™
      </button>
      <!-- Cart -->
<button class="relative">
  ğŸ›’
  <span class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">
    {{ (cartService.cart$ | async)?.length || 0 }}
  </span>
</button>


    </div>

    <!-- Mobile open button -->
    <button class="md:hidden text-xl" (click)="open.set(!open())">â˜°</button>
  </nav>

  <!-- Mobile Menu -->
  <div *ngIf="open()" class="md:hidden border-t border-black/10 bg-white/90 dark:bg-black/70 backdrop-blur-xl">
    <ul class="px-4 py-4 space-y-4">

      <li *ngFor="let group of menu; index as gi">
        <div class="flex justify-between items-center cursor-pointer"
             (click)="submenuOpen() === gi ? submenuOpen.set(null) : submenuOpen.set(gi)">
          <span class="text-base font-medium">{{ group.label }}</span>
          <span class="text-lg">â–¾</span>
        </div>

        <ul *ngIf="submenuOpen() === gi" class="pl-4 mt-2 space-y-2">
          <li *ngFor="let item of group.children">
            <a
              [routerLink]="item.link"
              class="block py-1 text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white"
              (click)="open.set(false)"
            >
              {{ ('nav.' + item.key) | translate }}
            </a>
          </li>
        </ul>
      </li>

      <!-- Lang Switch mobile -->
      <li>
        <div class="flex items-center gap-3">
          <span class="text-sm">Langue :</span>

          <button
            (click)="submenuOpen() === 999 ? submenuOpen.set(null) : submenuOpen.set(999)"
            class="flex items-center gap-2 px-2 py-1 rounded hover:bg-gray-200 dark:hover:bg-zinc-700 transition"
          >
            <span class="text-xl">{{ flags[currentLang()] }}</span>
            <span>{{ currentLang().toUpperCase() }}</span>
            <span class="text-xs opacity-60">â–¾</span>
          </button>
        </div>

        <ul *ngIf="submenuOpen() === 999" class="pl-4 mt-2 space-y-2">
          <li *ngFor="let l of langs">
            <button
              (click)="setLang(l); submenuOpen.set(null)"
              class="flex items-center gap-2 py-1 hover:text-black dark:hover:text-white"
            >
              <span class="text-xl">{{ flags[l] }}</span>
              <span>{{ l.toUpperCase() }}</span>
            </button>
          </li>
        </ul>
      </li>
      <li class="flex items-center gap-3">
  <span>Panier :</span>
  <button class="relative px-2 py-1 rounded hover:bg-gray-200 dark:hover:bg-zinc-700 transition">
    ğŸ›’
    <span *ngIf="cartLength > 0" 
          class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">
      {{ cartLength }}
    </span>
  </button>
</li>

    </ul>
  </div>
</header>


